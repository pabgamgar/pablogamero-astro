---
import MainLayout from "./MainLayout.astro";
import BackButton from "@/components/BackButton.astro";
import type { CollectionEntry } from "astro:content";
export interface Props {
    post: CollectionEntry<"blog" | "blog_es">;
    lang: "en" | "es";
}

const { post, lang } = Astro.props;
const { title, description, date, tags } = post.data;
const { Content } = await post.render();

// Average reading speed: 200 words per minute
function calculateReadingTime(content: string): number {
    const words = content.trim().split(/\s+/).length;
    const minutes = Math.ceil(words / 200);
    return minutes;
}

const readingTime = calculateReadingTime(post.body);

// Format date
const formattedDate =
    lang === "es"
        ? date.toLocaleDateString("es-ES", {
              day: "2-digit",
              month: "2-digit",
              year: "2-digit",
          })
        : date.toLocaleDateString("en-US", {
              year: "numeric",
              month: "long",
              day: "numeric",
          });
---

<MainLayout
    title={`${title} • Pablo Gamero`}
    desc={description}
    kw={tags?.join(", ") || ""}
    lang={lang}
    canon={`https://pablogamero.com${lang === "es" ? "/es" : ""}/blog/${post.slug}`}
    alt={`https://pablogamero.com${lang === "es" ? "" : "/es"}/blog/${post.slug}`}
>
    <article
        class="flex w-full max-w-3xl flex-col items-start gap-8 px-4 pb-16 pt-6 sm:px-6 md:px-8"
    >
        <BackButton
            link={lang === "es" ? "/es/blog" : "/blog"}
            text={lang === "es" ? "Volver a blog" : "Back to blog"}
        />
        <header class="flex w-full flex-col gap-3">
            <h1
                class="text-3xl font-semibold leading-tight sm:text-4xl"
                transition:name={`title-${post.slug}`}
            >
                {title}
            </h1>
            <div
                class="flex flex-wrap items-center gap-2 text-sm text-white/70"
            >
                <time datetime={date.toISOString()} transition:name={`postDate`}
                    >{formattedDate}</time
                >
                <span class="text-white/30">•</span>
                <span class="reading-time">
                    {readingTime}
                    {lang === "es" ? "min de lectura" : "min read"}
                </span>
                {
                    tags && tags.length > 0 && (
                        <>
                            <span class="text-white/30">•</span>
                            <div class="flex flex-wrap items-center gap-2">
                                {tags.map((tag) => (
                                    <span class="flex items-center justify-between rounded-full border border-white/40 px-2.5 py-1 text-xs">
                                        {tag}
                                    </span>
                                ))}
                            </div>
                        </>
                    )
                }
            </div>
        </header>

        <div class="blog-content flex w-full flex-col gap-4 text-white/90">
            <Content />
        </div>
    </article>
</MainLayout>

<style is:inline>
    .blog-content a {
        text-decoration: underline;
        color: var(--primary);
        text-underline-offset: 4px;
    }
    .blog-content p {
        line-height: 1.75;
    }
    .blog-content p + ul,
    .blog-content p + ol {
        margin-top: -0.75rem;
    }
    .blog-content h2 {
        font-size: 1.5rem;
        line-height: 1.35;
        font-weight: 600;
        margin-top: 1.25rem;
    }
    .blog-content h3 {
        font-size: 1.1rem;
        line-height: 1.4;
        font-weight: 600;
        margin-top: 1rem;
    }
    .blog-content ul,
    .blog-content ol {
        list-style-position: outside !important;
        padding-left: 1.25rem !important;
        margin-left: 0.25rem;
        gap: 0.5rem;
    }
    .blog-content ul {
        list-style: disc !important;
    }
    .blog-content ol {
        list-style: decimal !important;
    }
    .blog-content li {
        line-height: 1.7;
        display: list-item !important;
    }
    .blog-content blockquote {
        border-left: 2px solid rgba(255, 255, 255, 0.2);
        padding-left: 1rem;
        color: rgba(255, 255, 255, 0.75);
        font-style: italic;
    }
    .blog-content code {
        font-size: 0.9em;
        background: rgba(255, 255, 255, 0.08);
        padding: 0.1rem 0.3rem;
        border-radius: 0.25rem;
    }
    .blog-content pre {
        background: rgba(0, 0, 0, 0.5);
        padding: 1rem;
        border-radius: 0.5rem;
        overflow-x: auto;
    }
    .blog-content pre code {
        background: transparent;
        padding: 0;
    }
    .blog-content img {
        border-radius: 0.75rem;
    }
    .blog-content hr {
        border-color: rgba(255, 255, 255, 0.1);
    }
</style>
