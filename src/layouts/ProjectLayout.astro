---
import type { WorkItem } from "@/content/config";
import type { CollectionEntry, Render, RenderedContent } from "astro:content";
import MainLayout from "./MainLayout.astro";
import PostTile from "@/components/PostTile.astro";

interface Props {
    project: {
        id: string;
        render(): Render[".md"];
        slug: string;
        body: string;
        collection: "projects" | "proyectos";
        data: WorkItem;
        rendered?: RenderedContent;
        filePath?: string;
    };
    lang: "en" | "es";
    relatedPosts?: CollectionEntry<"blog" | "blog_es">[];
}

const { project, lang } = Astro.props;
const { slug, data } = project;
const { name, title, description, links } = data;
const descriptionText = Array.isArray(description)
    ? description.join(" ")
    : description;
const metaDescription = Array.isArray(description)
    ? description[0]
    : description;
const relatedPosts = Astro.props.relatedPosts ?? [];
---

<MainLayout
    title={name}
    desc={metaDescription}
    kw={name}
    canon={`https://pablogamero.com${lang === "en" ? "/projects" : "/es/proyectos"}/${slug}`}
    alt={`https://pablogamero.com${lang === "en" ? "/es/proyectos" : "/projects"}/${slug}`}
    lang={lang}
>
    <article
        class="text-white max-w-4xl flex flex-col gap-8 self-center px-4 sm:px-8 md:px-12 py-4"
    >
        <section id="hero" class="w-full flex flex-col gap-4">
            <h1 class="font-bold text-pretty flex gap-4 items-center">
                {name}{title && `: ${title}`}
            </h1>
            <p class="text-pretty text-neutral-300">{descriptionText}</p>
            <div class="w-full aspect-video overflow-clip rounded-xl">
                <img
                    src={`/images/${slug}-show.webp`}
                    alt={name}
                    class="object-cover w-full h-full"
                    transition:name={`img-${slug}`}
                />
            </div>
            <div class="flex gap-4">
                {
                    Object.entries(links).map(([name, link]) => (
                        <a
                            href={link}
                            class="flex items-center justify-center rounded-lg
                            border border-white/15
                            bg-white/[0.03]
                            hover:border-white/25
                            hover:bg-white/[0.05] transition-all duration-300 px-3 py-1"
                        >
                            {name}
                        </a>
                    ))
                }
            </div>
        </section>
        <section id="content" class="flex flex-col gap-4">
            <slot />
        </section>
        <div class="project-divider" aria-hidden="true"></div>
        <section id="posts" class="flex flex-col gap-4">
            <h2 class="text-2xl font-semibold">
                {lang === "es"
                    ? "Posts sobre este proyecto"
                    : "Posts about this project"}
            </h2>
            {
                relatedPosts.length > 0 ? (
                    <div class="flex flex-col gap-2">
                        {relatedPosts.map((post) => (
                            <PostTile post={post} lang={lang} />
                        ))}
                    </div>
                ) : (
                    <p class="text-neutral-300">
                        {lang === "es"
                            ? "Todav√≠a no hay posts sobre este proyecto."
                            : "No posts about this project yet."}
                    </p>
                )
            }
        </section>
    </article>
</MainLayout>
<style is:inline>
    ul {
        list-style-type: disc;
        margin-left: 1.5rem;
        margin-bottom: 1rem;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    li {
        display: list-item;
    }

    .project-divider {
        height: 1px;
        width: 100%;
        background: linear-gradient(
            90deg,
            rgba(255, 255, 255, 0.05),
            rgba(255, 255, 255, 0.3),
            rgba(255, 255, 255, 0.05)
        );
    }
</style>
