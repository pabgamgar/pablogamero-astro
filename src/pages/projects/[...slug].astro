---
import ProjectLayout from "@/layouts/ProjectLayout.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
    const projects = await getCollection("projects");
    return projects.map((project) => ({
        params: { slug: project.slug },
        props: { project },
    }));
}

const { project } = Astro.props;
const { Content } = await render(project);
const blogPosts = await getCollection("blog", ({ data }) => !data.draft);
const relatedPosts = blogPosts
    .filter((post) => {
        const projectSlug = project.slug;
        return (
            post.data.project === projectSlug ||
            post.data.projects?.includes(projectSlug)
        );
    })
    .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<ProjectLayout project={project} lang="en" relatedPosts={relatedPosts}>
    <Content />
</ProjectLayout>
